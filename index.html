<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hotel Directory - Taxi App</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=DM+Sans:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1a73e8;
            --accent: #f59e0b;
            --danger: #ef4444;
            --green: #10b981;
            --bg: #f0f4ff;
            --card: #ffffff;
            --text: #1e293b;
            --muted: #64748b;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'DM Sans', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 16px;
        }

        h1.page-title {
            font-family: 'Syne', sans-serif;
            text-align: center;
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 20px;
            letter-spacing: -0.5px;
        }

        #hotel-list {
            max-width: 520px;
            margin: auto;
        }

        /* ‚îÄ‚îÄ Hotel Card ‚îÄ‚îÄ */
        .hotel-card {
            background: var(--card);
            border-radius: 18px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            overflow: hidden;
            border: 1px solid #e2e8f0;
            animation: fadeUp 0.4s ease both;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(18px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ‚îÄ‚îÄ Gallery ‚îÄ‚îÄ */
        .gallery-wrap {
            position: relative;
            height: 190px;
            background: #dde3f0;
            overflow: hidden;
            cursor: pointer;
        }

        .gallery-wrap img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .gallery-wrap img.active { opacity: 1; }

        .gal-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.85);
            border: none;
            border-radius: 50%;
            width: 32px; height: 32px;
            font-size: 16px;
            cursor: pointer;
            z-index: 2;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.18);
            transition: background 0.2s;
        }
        .gal-btn:hover { background: #fff; }
        .gal-prev { left: 8px; }
        .gal-next { right: 8px; }

        .gal-dots {
            position: absolute;
            bottom: 8px; left: 0; right: 0;
            display: flex; justify-content: center; gap: 5px;
        }
        .gal-dot {
            width: 7px; height: 7px;
            border-radius: 50%;
            background: rgba(255,255,255,0.55);
            transition: background 0.2s, transform 0.2s;
        }
        .gal-dot.active { background: #fff; transform: scale(1.3); }

        .photo-count-badge {
            position: absolute;
            top: 10px; right: 10px;
            background: rgba(0,0,0,0.55);
            color: #fff;
            font-size: 11px;
            font-weight: 600;
            padding: 3px 8px;
            border-radius: 20px;
        }

        /* ‚îÄ‚îÄ Card Body ‚îÄ‚îÄ */
        .container { padding: 16px; }

        .hotel-name {
            font-family: 'Syne', sans-serif;
            font-size: 1.2rem;
            color: var(--primary);
            cursor: pointer;
            margin-bottom: 8px;
            transition: color 0.2s;
        }
        .hotel-name:hover { color: #1558c0; }

        .comm-badge {
            background: #fff8e1;
            color: #92400e;
            padding: 5px 12px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-weight: 700;
            font-size: 13px;
            margin-bottom: 14px;
            border: 1px solid #fde68a;
        }

        /* ‚îÄ‚îÄ Room Section ‚îÄ‚îÄ */
        .rooms-section-title {
            font-family: 'Syne', sans-serif;
            font-size: 0.78rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--muted);
            margin-bottom: 8px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 5px;
        }

        .room-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            font-size: 14px;
            gap: 8px;
        }

        .room-label { color: var(--text); font-weight: 500; flex: 1; }
        .room-price { color: var(--muted); font-size: 12px; }

        .room-select-wrap {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        select {
            padding: 5px 8px;
            border-radius: 8px;
            border: 1.5px solid #cbd5e1;
            font-size: 14px;
            font-family: 'DM Sans', sans-serif;
            width: 62px;
            background: #f8fafc;
            color: var(--text);
            cursor: not-allowed;
            transition: border-color 0.2s, background 0.2s;
        }
        select:not([disabled]) {
            cursor: pointer;
            border-color: var(--primary);
            background: #eff6ff;
        }

        .map-link {
            color: var(--primary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            margin-top: 12px;
            padding: 6px 12px;
            background: #eff6ff;
            border-radius: 8px;
            transition: background 0.2s;
        }
        .map-link:hover { background: #dbeafe; }

        /* ‚îÄ‚îÄ Lightbox ‚îÄ‚îÄ */
        .lightbox {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.92);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            gap: 14px;
        }
        .lightbox.open { display: flex; }
        .lightbox img {
            max-width: 94vw;
            max-height: 80vh;
            border-radius: 12px;
            object-fit: contain;
            box-shadow: 0 8px 40px rgba(0,0,0,0.5);
        }
        .lb-close {
            position: absolute;
            top: 16px; right: 20px;
            color: #fff;
            font-size: 28px;
            cursor: pointer;
            background: none;
            border: none;
            line-height: 1;
        }
        .lb-nav {
            display: flex;
            gap: 20px;
        }
        .lb-nav button {
            background: rgba(255,255,255,0.15);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 20px;
            font-size: 18px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .lb-nav button:hover { background: rgba(255,255,255,0.3); }
        .lb-counter { color: rgba(255,255,255,0.7); font-size: 13px; }

        /* Loading */
        .loading-text { text-align: center; color: var(--muted); padding: 40px; font-size: 15px; }
    </style>
</head>
<body>

<h1 class="page-title">üè® Hotel Directory</h1>
<div id="hotel-list"><p class="loading-text">‚è≥ Loading hotels...</p></div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
    <button class="lb-close" onclick="closeLightbox()">‚úï</button>
    <img id="lb-img" src="" alt="">
    <div class="lb-nav">
        <button onclick="lbNav(-1)">‚Äπ Prev</button>
        <span class="lb-counter" id="lb-counter"></span>
        <button onclick="lbNav(1)">Next ‚Ä∫</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getDatabase, ref, onValue, update, get } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCvjtl_xusE7v6nXWSqabujY-88Apu-WR8",
        authDomain: "taxi-commission.firebaseapp.com",
        databaseURL: "https://taxi-commission-default-rtdb.firebaseio.com",
        projectId: "taxi-commission"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Lightbox state
    let lbImages = [], lbIndex = 0;
    window.openLightbox = (images, startIndex) => {
        lbImages = images; lbIndex = startIndex;
        document.getElementById('lb-img').src = lbImages[lbIndex];
        document.getElementById('lb-counter').textContent = `${lbIndex + 1} / ${lbImages.length}`;
        document.getElementById('lightbox').classList.add('open');
    };
    window.closeLightbox = () => document.getElementById('lightbox').classList.remove('open');
    window.lbNav = (dir) => {
        lbIndex = (lbIndex + dir + lbImages.length) % lbImages.length;
        document.getElementById('lb-img').src = lbImages[lbIndex];
        document.getElementById('lb-counter').textContent = `${lbIndex + 1} / ${lbImages.length}`;
    };

    // Gallery helpers
    function makeGallery(hotelId, photos) {
        const wrap = document.createElement('div');
        wrap.className = 'gallery-wrap';

        if (!photos || photos.length === 0) {
            wrap.innerHTML = `<img src="https://via.placeholder.com/500x200?text=No+Photo" class="active" style="opacity:1;">`;
            return wrap;
        }

        photos.forEach((url, i) => {
            const img = document.createElement('img');
            img.src = url;
            img.className = i === 0 ? 'active' : '';
            img.onclick = () => openLightbox(photos, i);
            wrap.appendChild(img);
        });

        if (photos.length > 1) {
            const prev = document.createElement('button');
            prev.className = 'gal-btn gal-prev'; prev.textContent = '‚Äπ';
            const next = document.createElement('button');
            next.className = 'gal-btn gal-next'; next.textContent = '‚Ä∫';

            const dotsWrap = document.createElement('div');
            dotsWrap.className = 'gal-dots';
            photos.forEach((_, i) => {
                const d = document.createElement('div');
                d.className = 'gal-dot' + (i === 0 ? ' active' : '');
                dotsWrap.appendChild(d);
            });

            let cur = 0;
            function goTo(n) {
                wrap.querySelectorAll('img')[cur].classList.remove('active');
                dotsWrap.children[cur].classList.remove('active');
                cur = (n + photos.length) % photos.length;
                wrap.querySelectorAll('img')[cur].classList.add('active');
                dotsWrap.children[cur].classList.add('active');
            }
            prev.onclick = (e) => { e.stopPropagation(); goTo(cur - 1); };
            next.onclick = (e) => { e.stopPropagation(); goTo(cur + 1); };

            wrap.appendChild(prev);
            wrap.appendChild(next);
            wrap.appendChild(dotsWrap);

            const badge = document.createElement('div');
            badge.className = 'photo-count-badge';
            badge.textContent = `üì∑ ${photos.length}`;
            wrap.appendChild(badge);
        }

        return wrap;
    }

    function generateOptions(selected) {
        let opts = "";
        for (let i = 0; i <= 20; i++) {
            opts += `<option value="${i}" ${i == selected ? 'selected' : ''}>${i}</option>`;
        }
        return opts;
    }

    onValue(ref(db, 'hotels'), (snapshot) => {
        const hotelList = document.getElementById('hotel-list');
        hotelList.innerHTML = "";
        const data = snapshot.val();
        if (!data) { hotelList.innerHTML = '<p class="loading-text">No hotels found.</p>'; return; }

        let delay = 0;
        for (let id in data) {
            const hotel = data[id];
            const photos = hotel.photos ? Object.values(hotel.photos) : (hotel.img ? [hotel.img] : []);

            const card = document.createElement('div');
            card.className = 'hotel-card';
            card.style.animationDelay = `${delay}ms`;
            delay += 80;

            // Gallery
            card.appendChild(makeGallery(id, photos));

            // Body
            const body = document.createElement('div');
            body.className = 'container';
            body.innerHTML = `
                <h2 class="hotel-name" title="Double-tap to unlock editing" ondblclick="window.unlockManager('${id}', this)">${hotel.name}</h2>
                <div class="comm-badge">üöñ Commission: ‚Çπ${hotel.commission}</div>

                <div class="rooms-section-title">üõèÔ∏è Vacate Rooms</div>
                <div class="room-row">
                    <span class="room-label">A/C <span class="room-price">(Starts ‚Çπ${hotel.acPrice})</span></span>
                    <div class="room-select-wrap">
                        <span style="font-size:12px;color:#64748b;">Rooms:</span>
                        <select id="ac-${id}" disabled>${generateOptions(hotel.acRooms)}</select>
                    </div>
                </div>
                <div class="room-row">
                    <span class="room-label">Non-A/C <span class="room-price">(Starts ‚Çπ${hotel.nacPrice})</span></span>
                    <div class="room-select-wrap">
                        <span style="font-size:12px;color:#64748b;">Rooms:</span>
                        <select id="nac-${id}" disabled>${generateOptions(hotel.nacRooms)}</select>
                    </div>
                </div>
                <a href="${hotel.mapUrl}" target="_blank" class="map-link">üìç View Location</a>
            `;
            card.appendChild(body);
            hotelList.appendChild(card);
        }
    });

    window.unlockManager = async (hotelId, nameEl) => {
        const pass = prompt("Enter Manager Code for this Hotel:");
        if (!pass) return;
        const passSnap = await get(ref(db, `hotels/${hotelId}/password`));
        if (pass === passSnap.val()) {
            const acSel = document.getElementById(`ac-${hotelId}`);
            const nacSel = document.getElementById(`nac-${hotelId}`);
            acSel.disabled = false;
            nacSel.disabled = false;
            acSel.onchange = (e) => update(ref(db, `hotels/${hotelId}`), { acRooms: e.target.value });
            nacSel.onchange = (e) => update(ref(db, `hotels/${hotelId}`), { nacRooms: e.target.value });
            if (nameEl) nameEl.style.color = '#10b981';
            alert("‚úÖ Editing enabled!");
        } else {
            alert("‚ùå Incorrect Code!");
        }
    };
</script>
</body>
</html>
